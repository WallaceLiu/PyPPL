<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Pipeline configuration - PyPPL</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Pipeline configuration";
    var mkdocs_page_input_path = "configure-a-pipeline.md";
    var mkdocs_page_url = "/configure-a-pipeline/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../README/" class="icon icon-home"> PyPPL</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../README/">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../basic-concepts-and-directory-structure/">Basics and folder structure</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../placeholders/">Templating</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../channels/">Channels</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../specify-input-and-output-of-a-process/">Input and output of a process</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../write-your-script/">The heart: script</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../export-output-files/">Output file exporting</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../caching/">Caching and resuming processes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../runners/">Runners</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../set-other-properties-of-a-process/">Other attributes of a process</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../configure-your-logs/">Log configuration</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Pipeline configuration</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#configure-your-pipeline">Configure your pipeline</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#use-a-configuration-file">Use a configuration file</a></li>
        
            <li><a class="toctree-l3" href="#priority-of-configuration-options">Priority of configuration options</a></li>
        
            <li><a class="toctree-l3" href="#starting-processes">Starting processes</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../draw-flowchart-of-a-pipeline/">Pipeline flowchart</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../command-line-argument-parser/">Command line argument parser</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../aggregations/">Aggregations</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../command-line-tool/">Command line tool</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../api/">API</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../faq/">FAQ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../change-log/">Change log</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../README/">PyPPL</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../README/">Docs</a> &raquo;</li>
    
      
    
    <li>Pipeline configuration</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="configure-your-pipeline">Configure your pipeline</h1>
<!-- toc -->

<p>{% raw %}
To configure your pipeline, you just pass the configurations (a <code>dict</code>) to the constructor:</p>
<pre><code class="python">ppl = PyPPL(config)
</code></pre>

<p>Here is the full structure of the configurations (<strong><code>yaml</code> configuration file is also supported since <code>0.9.4</code></strong>):</p>
<pre><code class="json">{
    &quot;log&quot;: {
        &quot;levels&quot;: &quot;basic&quot;,  // the log levels
        &quot;theme&quot;: true,    // use colored log information
        &quot;lvldiff&quot;: [&quot;+DEBUG&quot;],  // modify the loglevels group
        &quot;file&quot;: false,    // disable logfile, or specify a different logfile
    },
    &quot;flowchart&quot;: {
        &quot;theme&quot;: &quot;default&quot;,
        &quot;dot&quot;: &quot;dot -Tsvg {{dotfile}} -o {{fcfile}}&quot;
    },
    &quot;proc&quot;: {            // shared configuration of processes
        &quot;forks&quot;: 10,
        &quot;runner&quot;: &quot;sge&quot;,
        &quot;sgeRunner&quot;: {
            // sge options
        }
    },
    &quot;profile1&quot; : {
        &quot;forks&quot;: 20,
        &quot;runner&quot;: &quot;ssh&quot;,
        &quot;sshRunner&quot;: {
            // ssh options
        }
    },
    &quot;profile2&quot;: {...},
    &quot;profile3&quot;: {...},
    ...
}
</code></pre>

<ul>
<li>For log configuration please refer to <a href="https://pwwang.gitbooks.io/pyppl/configure-your-logs.html">configure your logs</a></li>
<li>For flowchart configuration please refer to <a href="https://pwwang.gitbooks.io/pyppl/draw-flowchart-of-a-pipeline.html">pipeline flowchart</a></li>
<li><code>proc</code> defines the base running profile for processes in this pipeline. <a href="https://pwwang.gitbooks.io/pyppl/content/set-other-properties-of-a-process.html">All the properties</a> of a process can be set here, but just some common one are recommended. Obviously, <code>input</code> is not suitable to be set here, except some extreme cases.</li>
<li><code>profiles</code> defines some profiles that may be shared by the processes. To use a profile, just specify the profile name to <code>run</code>: <code>PyPPL(config).start(process).run(&lt;profile&gt;)</code>.</li>
</ul>
<blockquote>
<p><strong>Info</strong> Settings for <code>profiles</code> are actually the same as for <code>proc</code>. They just make you easy to switch the profiles back and forth. For example, you want to run with sge runner this time, but ssh runner next time, what you need to do is just change from <code>...run("profile_sge")</code> to <code>...run("profile_ssh")</code>
<strong>Note</strong> You may also use the runner name as a profile. That means, following profiles are implied in the configuration:</p>
</blockquote>
<pre><code class="json">{
    &quot;sge&quot;  : {&quot;runner&quot;: &quot;sge&quot;},
    &quot;ssh&quot;  : {&quot;runner&quot;: &quot;ssh&quot;},
    &quot;slurm&quot;: {&quot;runner&quot;: &quot;slurm&quot;},
    &quot;local&quot;: {&quot;runner&quot;: &quot;local&quot;},
    &quot;dry&quot;  : {&quot;runner&quot;: &quot;dry&quot;},
}
</code></pre>

<blockquote>
<p><strong>Caution</strong> You cannot define profiles with names <code>flowchart</code> and <code>log</code></p>
</blockquote>
<h2 id="use-a-configuration-file">Use a configuration file</h2>
<p><code>PyPPL</code> will look for configuration files at <code>~/.PyPPL</code> and <code>~/.PyPPL.json</code> if both or either of them exist. If both of them exist, <code>~/.PyPPL.json</code> has higher priority, which means the options will be overwritten in <code>~/.PyPPL</code> by those in <code>~/.PyPPL.json</code>. But to avoid confusion, you'd better just use either of them.</p>
<p>You can also use another configuration file explictly (say, <code>/a/b/pyppl.config.json</code>), and then specify it to <code>PyPPL</code> constructor:</p>
<pre><code class="python">PyPPL({}, &quot;/a/b/pyppl.config.json&quot;)
# or 
PyPPL (cfgfile = &quot;/a/b/pyppl.config.json&quot;)
</code></pre>

<p>In this case, <code>/a/b/pyppl.config.json</code> has the highest priority of all configuration files.
All other options will be inherited from <code>~/.PyPPL.json</code> and them <code>~/.PyPPL</code>.</p>
<h2 id="priority-of-configuration-options">Priority of configuration options</h2>
<p>Now you have 3 ways to set attributes for a process: 
- directly set the process attributes <em>(1)</em>, 
- set in the first argument (<code>config</code>) of <code>PyPPL</code> constructor <em>(2)</em>, 
- set in a configuration file <code>/a/b/pyppl.config.json</code> <em>(3)</em>,
- set in configuration file <code>~/.PyPPL.json</code> <em>(4)</em>, and
- set in configuration file <code>~/.PyPPL</code> <em>(5)</em></p>
<p><strong>The priority is: (1) &gt; (2) &gt; (3) &gt; (4) &gt; (5).</strong>
Once you set the property of the process, it will never be changed by <code>PyPPL</code> constructor or the configuration file. But the first argument can overwrite the options in configuration files.
Here are an examples to illustrate the priority:</p>
<p><strong> Example 1:</strong></p>
<pre><code class="python"># ~/.PyPPL.json
&quot;&quot;&quot;
{
    &quot;proc&quot;: {&quot;forks&quot;: 5}
}
&quot;&quot;&quot;

p = Proc()
p.forks = 1

ppl = PyPPL({&quot;proc&quot;: {forks: 10}})

# p.forks == 1
</code></pre>

<p><strong> Example 2:</strong></p>
<pre><code class="python"># we also have ~/.PyPPL.json as previous example
p = Proc()

ppl = PyPPL({&quot;proc&quot;: {forks: 10}})

# p.forks == 10
</code></pre>

<p><strong> Example 3:</strong></p>
<pre><code class="python"># we also have ~/.PyPPL.json as previous example
p = Proc()

ppl = PyPPL()

# p.forks == 5
</code></pre>

<h2 id="starting-processes">Starting processes</h2>
<p>It's very easy to set the starting processes of the pipeline, just pass them to <code>start</code> function. A pipeline can have multiple starting processes:</p>
<pre><code class="python">PyPPL().start(p1,p2,p3).run()
</code></pre>

<p>You may also use a common id to set a set of processes:</p>
<pre><code class="python">p1 = Proc(newid = 'p', tag = '1st')
p2 = Proc(newid = 'p', tag = '2nd')
p3 = Proc(newid = 'p', tag = '3rd')
# all p1, p2, p3 will be starting processes
PyPPL().start('p').run()
</code></pre>

<blockquote>
<p><strong>Caution</strong> 
1. If a process is depending on other processes, you are not supposed to set it as starting process. Of course you can, but make sure the input channel can be normally constructed.
2. If a process is not depending on any other processes, you have to set it as starting process. Otherwise, it won't start to run.</p>
</blockquote>
<p>{% endraw %}</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../draw-flowchart-of-a-pipeline/" class="btn btn-neutral float-right" title="Pipeline flowchart">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../configure-your-logs/" class="btn btn-neutral" title="Log configuration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../configure-your-logs/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../draw-flowchart-of-a-pipeline/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
